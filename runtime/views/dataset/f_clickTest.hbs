{{#with dataset}}
    {{#include "script" this.name @root/report}}
        <script src='https://cdn.jsdelivr.net/npm/d3@7'></script>
        <script src='https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6'></script>
    {{/include}}

document.addEventListener("DOMContentLoaded", (event) => {
    document.querySelector("#dataset_{{options.source}}").
        addEventListener("mouseover",showGraph)
})


function showGraph(evt){
    let clickedData = getData(evt.target)
    if (clickedData){
        let month = clickedData.month
        let year = clickedData.year
        let data = report.data["main"].data.filter((d)=>{return (d.d.getMonth() == (month-1) && d.d.getFullYear() == year)})
        // let graph = Plot.line(data, {x: "d", y: "posts"}).plot({y: {grid: true}})
        let graph = Plot.plot({
            marks: [
                    ()=>{let style =  document.createElement("style")
                         style.appendChild(document.createTextNode(' .info { stroke: "red"} '))
                         return style
                        },
                    Plot.line(data, {x: "d", y: "posts"}),
                    Plot.circle(data, {x: "d", y: "posts",stroke:"red",r:2})
           ],
            y: {grid: true}
        })
        const div = document.querySelector("#dataset_detail");
        div.innerHTML = ""
        div.append(graph)
    }
}

{{/with}}